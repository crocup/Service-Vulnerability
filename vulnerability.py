from abc import ABC, abstractmethod
from pprint import pprint
from typing import Dict
import requests
import json
import config


class AbstractVulnerability(ABC):
    """
    pass
    """
    def template_method(self, vendor=None, product=None, version=None, cpe=None) -> Dict:
        """
        pass
        :param vendor:
        :param product:
        :param version:
        :param cpe:
        :return:
        """
        self.base_operation()
        return self.required_vulnerability(vendor, product, version, cpe)

    def base_operation(self) -> None:
        """
        pass
        :return:
        """
        print("Found Vilnerability")

    @abstractmethod
    def required_vulnerability(self, vendor, product, version, cpe) -> Dict:
        pass


class VulnDB(AbstractVulnerability):
    """
    pass
    """
    def __init__(self):
        """
        pass
        """
        self.api = config.Config.API
        self.user_agent = 'VulDB API Python Agent'

    def required_vulnerability(self, vendor, product, version, cpe) -> Dict:
        """
        pass
        :param vendor:
        :param product:
        :param version:
        :param cpe:
        :return:
        """
        url = 'https://vuldb.com/?api'
        headers = {'User-Agent': self.user_agent, 'X-VulDB-ApiKey': self.api}
        post_data = {'advancedsearch': f'product:{product},version:{version}', 'limit': 1}
        response = requests.post(url, headers=headers, data=post_data)
        if response.status_code == 200:
            response_json = json.loads(response.content)
        else:
            response_json = {}
        return response_json


def result_code(abstract_vulnerability: AbstractVulnerability) -> Dict:
    """

    :param abstract_vulnerability:
    :return:
    """
    return abstract_vulnerability.template_method(vendor="Microsoft", product="Windows", version=10)


if __name__ == "__main__":
    print("Start...")
    res = result_code(VulnDB())
    pprint(res)
    print("Stop...")
