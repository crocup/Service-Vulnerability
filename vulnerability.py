from abc import ABC, abstractmethod
from typing import Dict
import requests
import json
import config


class AbstractVulnerability(ABC):
    """
    pass
    """

    def template_method(self, **kwargs) -> Dict:
        """
        pass
        :return:
        """
        return self.required_vulnerability(**kwargs)

    def base_operation(self) -> None:
        """
        pass
        :return:
        """
        print("Start...")

    def end_operation(self) -> None:
        """
        pass
        :return:
        """
        print("Stop...")

    @abstractmethod
    def required_vulnerability(self, **kwargs) -> Dict:
        pass


class VulnDB(AbstractVulnerability):
    """
    pass
    """

    def __init__(self):
        """
        pass
        """
        self.api = config.Config.API
        self.user_agent = 'VulDB API Python Agent'

    def required_vulnerability(self, **kwargs) -> Dict:
        """
        pass
        :return:
        """
        url = 'https://vuldb.com/?api'
        headers = {'User-Agent': self.user_agent, 'X-VulDB-ApiKey': self.api}
        post_data = {'advancedsearch': f'product:{kwargs["product"]},version:{kwargs["version"]}', 'limit': 10}
        response = requests.post(url, headers=headers, data=post_data)
        if response.status_code == 200:
            response_json = json.loads(response.content)
        else:
            response_json = {}
        return response_json


def result_code(abstract_vulnerability: AbstractVulnerability, **kwargs) -> Dict:
    """

    :param abstract_vulnerability:
    :return:
    """
    return abstract_vulnerability.template_method(**kwargs)
